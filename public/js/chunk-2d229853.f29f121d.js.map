{"version":3,"sources":["webpack:///./src/views/ap/teacher/login/PasswordForget.vue?b4bd","webpack:///./src/controllers/ap/teacher/login/PasswordForget.ts","webpack:///./src/controllers/ap/teacher/login/PasswordForget.ts?6840","webpack:///./src/views/ap/teacher/login/PasswordForget.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","_m","_v","directives","name","rawName","value","loginForm","expression","domProps","on","$event","target","composing","$set","errorMsg","form","_s","verificationCode","imgSrc","doubleClick","preventDefault","refreshVerificationCode","validateAndSubmit","lightbox","staticRenderFns","account","verification","IsDefined","IsNotEmpty","uid","response","created","timestamp","Math","floor","Date","now","toString","random","codeItem","uniqueID","refreshCodeImg","skipMissingProperties","then","result","length","forEach","item","index","property","code","verificationCodeCheck","verificationCodeErrNo","Success","acc","teForgetPwd","errNo","$emit","ApTeacherLoginPasswordController","components","APLightbox","component"],"mappings":"iKAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACA,EAAG,MAAM,CAACE,YAAY,cAAc,CAACF,EAAG,MAAM,CAACE,YAAY,aAAa,CAACF,EAAG,MAAM,CAACE,YAAY,QAAQF,EAAG,OAAO,CAACG,MAAM,CAAC,OAAS,OAAO,KAAO,QAAQ,GAAK,UAAU,CAACP,EAAIQ,GAAG,GAAGR,EAAIQ,GAAG,GAAGJ,EAAG,MAAM,CAACE,YAAY,WAAW,CAACF,EAAG,MAAM,CAACE,YAAY,SAASF,EAAG,KAAK,CAACJ,EAAIS,GAAG,UAAUL,EAAG,MAAM,CAACE,YAAY,aAAa,CAACF,EAAG,IAAI,CAACE,YAAY,eAAeF,EAAG,QAAQ,CAACM,WAAW,CAAC,CAACC,KAAK,QAAQC,QAAQ,UAAUC,MAAOb,EAAIc,UAAiB,QAAEC,WAAW,sBAAsBT,YAAY,YAAYC,MAAM,CAAC,KAAO,OAAO,KAAO,UAAU,GAAK,UAAU,YAAc,iBAAiB,aAAe,OAAOS,SAAS,CAAC,MAAShB,EAAIc,UAAiB,SAAGG,GAAG,CAAC,MAAQ,SAASC,GAAWA,EAAOC,OAAOC,WAAqBpB,EAAIqB,KAAKrB,EAAIc,UAAW,UAAWI,EAAOC,OAAON,WAAWT,EAAG,QAAQ,CAACM,WAAW,CAAC,CAACC,KAAK,OAAOC,QAAQ,SAASC,MAA6B,KAAtBb,EAAIsB,SAASC,KAAaR,WAAW,yBAAyBT,YAAY,SAAS,CAACN,EAAIS,GAAG,IAAIT,EAAIwB,GAAGxB,EAAIsB,SAASC,WAAWnB,EAAG,MAAM,CAACE,YAAY,0CAA0C,CAACF,EAAG,MAAM,CAACE,YAAY,UAAUC,MAAM,CAAC,IAAMP,EAAIyB,iBAAiBC,UAAUtB,EAAG,MAAM,CAACE,YAAY,UAAUC,MAAM,CAAC,GAAK,UAAU,IAAM,EAAQ,QAAyC,SAAWP,EAAI2B,aAAaV,GAAG,CAAC,MAAQ,SAASC,GAAgC,OAAxBA,EAAOU,iBAAwB5B,EAAI6B,8BAA8BzB,EAAG,QAAQ,CAACM,WAAW,CAAC,CAACC,KAAK,QAAQC,QAAQ,UAAUC,MAAOb,EAAIc,UAAsB,aAAEC,WAAW,2BAA2BT,YAAY,kBAAkBC,MAAM,CAAC,KAAO,OAAO,YAAc,QAAQ,UAAY,EAAE,KAAO,WAAW,GAAK,YAAYS,SAAS,CAAC,MAAShB,EAAIc,UAAsB,cAAGG,GAAG,CAAC,MAAQ,SAASC,GAAWA,EAAOC,OAAOC,WAAqBpB,EAAIqB,KAAKrB,EAAIc,UAAW,eAAgBI,EAAOC,OAAON,aAAab,EAAIQ,GAAG,GAAGJ,EAAG,MAAM,CAACE,YAAY,mBAAmB,CAACF,EAAG,IAAI,CAACE,YAAY,uBAAuBC,MAAM,CAAC,SAAWP,EAAI2B,aAAaV,GAAG,CAAC,MAAQ,SAASC,GAAgC,OAAxBA,EAAOU,iBAAwB5B,EAAI8B,uBAAuB,CAAC9B,EAAIS,GAAG,UAAUL,EAAG,MAAM,CAACE,YAAY,kBAAkB,CAACN,EAAIS,GAAG,oBAAoBT,EAAIQ,GAAG,WAAWJ,EAAG,aAAa,CAACG,MAAM,CAAC,QAAUP,EAAI+B,SAAST,aAAa,IACpsEU,EAAkB,CAAC,WAAa,IAAIhC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,eAAe,CAACF,EAAG,MAAM,CAACG,MAAM,CAAC,IAAM,EAAQ,cAA+B,WAAa,IAAIP,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,eAAe,CAACF,EAAG,MAAM,CAACG,MAAM,CAAC,IAAM,EAAQ,cAA+B,WAAa,IAAIP,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,sBAAsB,CAACF,EAAG,IAAI,CAACE,YAAY,6BAA6BN,EAAIS,GAAG,2BAA2B,WAAa,IAAIT,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,mBAAmB,CAACF,EAAG,MAAM,CAACG,MAAM,CAAC,IAAM,EAAQ,e,gGCMpvB,0BAC+B,KAAA0B,QAAU,GACV,KAAAC,aAAe,GAC9C,OAF+B,gBAA1B,OAAAC,EAAA,QAAa,OAAAC,EAAA,S,8BACa,gBAA1B,OAAAD,EAAA,QAAa,OAAAC,EAAA,S,mCAClB,EAHA,GAYA,yE,OACY,EAAAT,aAAc,EACd,EAAAb,UAAY,IAAI,EAChB,EAAAW,iBAA8C,CAClDY,IAAK,GACLX,OAAQ,IAEJ,EAAAJ,SAA+C,CACnDC,KAAM,GACNe,SAAU,IAEN,EAAAP,SAAiC,CACrCT,SAAW,I,EAyEnB,OArF8D,oBAenD,YAAAiB,QAAP,WACItC,KAAK4B,2BAGK,YAAAA,wBAAd,W,uIACS5B,KAAK0B,YAAN,OACA1B,KAAK0B,aAAc,EAEba,EAAYC,KAAKC,MAAMC,KAAKC,MAAQ,KAAMC,WAC1CC,EAASL,KAAKC,MAAsB,IAAhBD,KAAKK,UAAiBD,WAChD5C,KAAKwB,iBAAiBY,IAAMG,EAAYM,EAElCC,EAAW,CACbC,SAAU/C,KAAKwB,iBAAiBY,KAEpC,EAAApC,KAAKwB,iBAA0B,GAAM,OAAawB,eAAeF,K,OAAjE,EAAsBrB,OAAS,SAC/BzB,KAAK0B,aAAc,E,mCAIb,YAAAG,kBAAd,W,+GACI,eAAS7B,KAAKa,UAAW,CAAEoC,uBAAuB,IAAQC,MACtD,SAAMC,GAAM,kD,oFACR,OAAsB,IAAlBA,EAAOC,QACD,EAAyC,CAC3CpB,QAAS,KACTC,aAAc,OAGlBjC,KAAKqB,SAASC,KAAO,MACrB6B,EAAOE,SAAQ,SAACC,EAAMC,GAClB,EAAKlC,SAASC,MAAmB,IAAViC,EAAe,EAAYD,EAAKE,UAAY,MAAQ,EAAYF,EAAKE,aAEhG,MAGJxD,KAAKqB,SAASC,KAAO,GAChBtB,KAAK0B,YAAN,OACA1B,KAAK0B,aAAc,EAEboB,EAAW,CACbW,KAAMzD,KAAKa,UAAUoB,aACrBc,SAAU/C,KAAKwB,iBAAiBY,KAGN,GAAM,OAAasB,sBAAsBZ,M,OAEvE,OAFMa,EAAwB,SAE1BA,IAA0B,OAAUC,SACpC5D,KAAKqB,SAASC,KAAO,OAAaqC,GAClC3D,KAAK0B,aAAc,EACnB1B,KAAK4B,0BACL,MAGE0B,EAAO,CACTO,IAAK7D,KAAKa,UAAUmB,SAEV,GAAM,OAAa8B,YAAYR,K,OAAvCS,EAAQ,SACVA,IAAU,OAAUH,SACpB5D,KAAK8B,SAAST,SAAW,sBACzBrB,KAAKgE,MAAM,kBAAkB,KAE7BhE,KAAKqB,SAASC,KAAO,OAAayC,GAClC/D,KAAK4B,2BAET5B,KAAK0B,aAAc,E,gDAhFlBuC,EAAgC,gBALpD,eAA4C,CACzCC,WAAY,CACRC,WAAU,WAGGF,GAqFrB,EArFA,CAA8D,QAAzC,ICnB0S,I,wBCQ3TG,EAAY,eACd,EACAtE,EACAiC,GACA,EACA,KACA,KACA,MAIa,aAAAqC,E","file":"js/chunk-2d229853.f29f121d.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:\"login-page\"},[_c('div',{staticClass:\"login-box\"},[_c('div',{staticClass:\"box\"}),_c('form',{attrs:{\"method\":\"post\",\"name\":\"login\",\"id\":\"login\"}},[_vm._m(0),_vm._m(1),_c('div',{staticClass:\"l-login\"},[_c('div',{staticClass:\"logo\"}),_c('h1',[_vm._v(\"忘記密碼\")]),_c('div',{staticClass:\"input-box\"},[_c('i',{staticClass:\"fa fa-user\"}),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.loginForm.account),expression:\"loginForm.account\"}],staticClass:\"input-sty\",attrs:{\"type\":\"text\",\"name\":\"account\",\"id\":\"account\",\"placeholder\":\" 請輸入您的帳號E-mail\",\"autocomplete\":\"off\"},domProps:{\"value\":(_vm.loginForm.account)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.loginForm, \"account\", $event.target.value)}}}),_c('label',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.errorMsg.form !== ''),expression:\"errorMsg.form !== ''\"}],staticClass:\"error\"},[_vm._v(\"*\"+_vm._s(_vm.errorMsg.form))])]),_c('div',{staticClass:\"input-box input-number h-flexCenter-ai\"},[_c('img',{staticClass:\"val-img\",attrs:{\"src\":_vm.verificationCode.imgSrc}}),_c('img',{staticClass:\"refresh\",attrs:{\"id\":\"refresh\",\"src\":require(\"@/img/backend_img/icon_contact_f5.png\"),\"disabled\":_vm.doubleClick},on:{\"click\":function($event){$event.preventDefault();return _vm.refreshVerificationCode()}}}),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.loginForm.verification),expression:\"loginForm.verification\"}],staticClass:\"input-code code\",attrs:{\"type\":\"text\",\"placeholder\":\"輸入驗證碼\",\"maxlength\":4,\"name\":\"code_num\",\"id\":\"code_num\"},domProps:{\"value\":(_vm.loginForm.verification)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.loginForm, \"verification\", $event.target.value)}}})]),_vm._m(2),_c('div',{staticClass:\"l-login-btn-box\"},[_c('a',{staticClass:\"btn login-submit-btn\",attrs:{\"disabled\":_vm.doubleClick},on:{\"click\":function($event){$event.preventDefault();return _vm.validateAndSubmit()}}},[_vm._v(\"送出\")])]),_c('div',{staticClass:\"l-login-footer\"},[_vm._v(\" ©2021 芝蔴街e學園 \")]),_vm._m(3)])])])]),_c('APLightbox',{attrs:{\"message\":_vm.lightbox.errorMsg}})],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login_dec02\"},[_c('img',{attrs:{\"src\":require(\"@/img/login_dec02.png\")}})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login_dec03\"},[_c('img',{attrs:{\"src\":require(\"@/img/login_dec03.png\")}})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"l-login-error-mesg\"},[_c('i',{staticClass:\"fa fa-exclamation-circle\"}),_vm._v(\"送出後將由系統發送密碼重置信至此帳號信箱\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"dec login_dec01\"},[_c('img',{attrs:{\"src\":require(\"@/img/login_dec01.png\")}})])}]\n\nexport { render, staticRenderFns }","import { Component, Vue } from \"vue-property-decorator\";\r\nimport { IsDefined, IsNotEmpty, validate } from \"class-validator\";\r\n\r\nimport { ErrorCode, ErrorMessage } from \"@/constant\";\r\nimport { AccountModel } from \"@/models\";\r\nimport { APLightbox } from \"@/components\";\r\n\r\nexport class LoginForm {\r\n    @IsDefined() @IsNotEmpty() account = '';\r\n    @IsDefined() @IsNotEmpty() verification = '';\r\n}\r\n\r\ntype response = { [key: string]: unknown };\r\n\r\n@Component<ApTeacherLoginPasswordController>({\r\n    components: {\r\n        APLightbox\r\n    }\r\n})\r\nexport default class ApTeacherLoginPasswordController extends Vue {\r\n    private doubleClick = false;\r\n    private loginForm = new LoginForm();\r\n    private verificationCode: { [key: string]: string } = {\r\n        uid: \"\",\r\n        imgSrc: \"\"\r\n    };\r\n    private errorMsg: { form: string; response: string } = {\r\n        form: \"\",\r\n        response: \"\"\r\n    };\r\n    private lightbox: { errorMsg: string } = {\r\n        errorMsg:  '',\r\n    };\r\n\r\n    public created() {\r\n        this.refreshVerificationCode(); //取得驗證碼圖片\r\n    }\r\n\r\n    private async refreshVerificationCode() {\r\n        if (!this.doubleClick) {\r\n            this.doubleClick = true;\r\n\r\n            const timestamp = Math.floor(Date.now() / 1000).toString();\r\n            const random = Math.floor(Math.random() * 1000).toString();\r\n            this.verificationCode.uid = timestamp + random;\r\n\r\n            const codeItem = {\r\n                uniqueID: this.verificationCode.uid\r\n            };\r\n            this.verificationCode.imgSrc = await AccountModel.refreshCodeImg(codeItem); //通過model call api回傳所需資料\r\n            this.doubleClick = false;\r\n        }\r\n    }\r\n\r\n    private async validateAndSubmit() {\r\n        validate(this.loginForm, { skipMissingProperties: true }).then(\r\n            async result => {\r\n                if (result.length !== 0) {\r\n                    const errorMsgMap: { [key: string]: string } = {\r\n                        account: \"帳號\",\r\n                        verification: \"驗證碼\"\r\n                    };\r\n\r\n                    this.errorMsg.form = \"請填入\";\r\n                    result.forEach((item, index) => { //組合error 提示字 -> Invalid Account / Password / Verification Code\r\n                        this.errorMsg.form += (index === 0) ? errorMsgMap[item.property] : \" / \" + errorMsgMap[item.property];\r\n                    });\r\n                    return;\r\n                }\r\n\r\n                this.errorMsg.form = \"\";\r\n                if (!this.doubleClick) {\r\n                    this.doubleClick = true;\r\n\r\n                    const codeItem = {\r\n                        code: this.loginForm.verification,\r\n                        uniqueID: this.verificationCode.uid\r\n                    };\r\n\r\n                    const verificationCodeErrNo = await AccountModel.verificationCodeCheck(codeItem); //呼叫api 驗證驗證碼正確性\r\n\r\n                    if (verificationCodeErrNo !== ErrorCode.Success) {\r\n                        this.errorMsg.form = ErrorMessage[verificationCodeErrNo];\r\n                        this.doubleClick = false;\r\n                        this.refreshVerificationCode();\r\n                        return;\r\n                    }\r\n\r\n                    const item = {\r\n                        acc: this.loginForm.account,\r\n                    };\r\n                    const errNo = await AccountModel.teForgetPwd(item);\r\n                    if (errNo === ErrorCode.Success) {\r\n                        this.lightbox.errorMsg = '已發送重設密碼信件，請前往電子信箱查看';\r\n                        this.$emit(\"openAPLightbox\", true);\r\n                    } else {\r\n                        this.errorMsg.form = ErrorMessage[errNo];\r\n                        this.refreshVerificationCode();\r\n                    }\r\n                    this.doubleClick = false;\r\n                }\r\n            }\r\n        );\r\n    }\r\n}","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/ts-loader/index.js??ref--13-2!../../../../../node_modules/eslint-loader/index.js??ref--12-0!./PasswordForget.ts?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/ts-loader/index.js??ref--13-2!../../../../../node_modules/eslint-loader/index.js??ref--12-0!./PasswordForget.ts?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./PasswordForget.vue?vue&type=template&id=7090ce45&\"\nimport script from \"@/controllers/ap/teacher/login/PasswordForget?vue&type=script&lang=ts&\"\nexport * from \"@/controllers/ap/teacher/login/PasswordForget?vue&type=script&lang=ts&\"\nimport style0 from \"@/assets/css/main.css?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}